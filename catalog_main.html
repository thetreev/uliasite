<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width", initial-scale="1"/>
        <title>warm hook store</title>
        <link rel="stylesheet" href="catalog.css" />
    </head>
    <body id="main">
        <div class="headup">
            <div class="zagbg">
                <h1 class="first_title"><a href="index.html">крючком с теплом</a></h1>
                <h2 class="second_title"><i>магазин вязаных игрушек</i></h2>
            </div>
        </div>
        <div class="headdown">
            <nav class="navi">
                <ul class="mul">
                    <li class="mlist"><a href="index.html">о создателе</a></li>
                    <li class="mlist here"><a href="catalog.html">каталог</a></li>
                    <li class="mlist"><a href="form.html">работа</a></li>
                </ul>
            </nav>
        </div>
        <div class="dropdown">
            <div class="pagendiv">
                <div class="tov" tabindex="0">
                    <h3>товары</h3>
                    <nav class="pagenav">
                        <ul class="pul">
                            <li class="plist"><a href="#toy">игрушки</a></li>
                            <li class="plist"><a href="#keychains">брелоки</a></li>
                            <li class="plist"><a href="#bookmarks">закладки</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <div class="maincont">
            <div  class="box">
                <h4 id="toy">игрушки</h4>
                <div class="product">
                    <img class="imgprod" alt="" src="img/bbkit.jpg" >
                    <p class="nameprod">тост с маслом в виде кита</p>
                    <p class="price">1100₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/orlyata.jpg" >
                    <p class="nameprod">орлята</p>
                    <p class="price">800₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/utyatoma.jpg" >
                    <p class="nameprod">утёнок в шляпе с томатом</p>
                    <p class="price">950₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/morzh.jpg" >
                    <p class="nameprod">тюлень</p>
                    <p class="price">900₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
            </div>
            <div class="box">
                <h4 id="keychains">брелоки</h4>
                <div class="product">
                    <img class="imgprod" alt="" src="img/arbuz.jpg" >
                    <p class="nameprod">долька арбуза</p>
                    <p class="price">750₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/dlinniyriba.jpg" >
                    <p class="nameprod">длиннорыбка</p>
                    <p class="price">650₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/vishenki.jpg" >
                    <p class="nameprod">вишенки</p>
                    <p class="price">800₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/kapi.jpg" >
                    <p class="nameprod">капибара</p>
                    <p class="price">550₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/zvezdi.jpg" >
                    <p class="nameprod">звездочки</p>
                    <p class="price">450₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
            </div>
            <div class="box">
                <h4 id="bookmarks">закладки</h4>
                <div class="product">
                    <img class="imgprod" alt="" src="img/greenlist.jpg" >
                    <p class="nameprod">четырёхлистный клевер</p>
                    <p class="price">300₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
                <div class="product">
                    <img class="imgprod" alt="" src="img/negreen.jpg" >
                    <p class="nameprod">росток</p>
                    <p class="price">300₽</p>
                    <div class="order-block">
                        <label class="order-label">
                            количество:
                            <input type="number" class="order-qty" min="0" placeholder="0">
                        </label>
                    </div>
                </div>
            </div>
            <div class="order-actions">
                <button id="submitOrder" type="button">заказать</button>
                <p id="orderMessage" class="order-message" aria-live="polite"></p>
            </div>
        </div>
        <div class="back"><a href="#main">в начало</a></div>
        <script>
            (function () {
                const SEARCH_URL = 'https://www.bing.com/search?q=';

                const submitBtn = document.getElementById('submitOrder');
                const messageEl = document.getElementById('orderMessage');

                function showMessage(text) {
                    if (messageEl) {
                        messageEl.textContent = text;
                    }
                }

                function clearInputs() {
                    document.querySelectorAll('.order-qty').forEach(function (input) {
                        input.value = '';
                    });
                }

                function sendData(data) {
                    return fetch(SEARCH_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                }

                if (submitBtn) {
                    submitBtn.addEventListener('click', function () {
                        const products = document.querySelectorAll('.product');
                        const items = [];

                        products.forEach(function (product) {
                            const qtyInput = product.querySelector('.order-qty');
                            if (!qtyInput) return;

                            const qty = parseInt(qtyInput.value || '0', 10);
                            if (qty > 0) {
                                const nameEl = product.querySelector('.nameprod');
                                const priceEl = product.querySelector('.price');

                                const name = nameEl ? nameEl.textContent.trim() : '';
                                const price = priceEl ? priceEl.textContent.trim() : '';

                                items.push({
                                    name: name,
                                    price: price,
                                    quantity: qty
                                });
                            }
                        });

                        if (items.length === 0) {
                            showMessage('Вы не указали количество ни для одного товара.');
                            return;
                        }

                        const payload = {
                            items: items,
                            timestamp: new Date().toISOString()
                        };

                        sendData(payload)
                            .then(function () {
                                showMessage('Заказ отправлен!');
                                clearInputs();
                            })
                            .catch(function () {
                                showMessage('Ошибка отправки. Попробуйте позже.');
                            });
                    });
                }
            })();
        </script>
    </body> 
</html>